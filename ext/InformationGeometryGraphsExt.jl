module InformationGeometryGraphsExt


using InformationGeometry, LinearAlgebra, Graphs, TikzGraphs
import InformationGeometry: pnames, StringOrSymb


signsqrtabs(x::Number) = sign(x) * sqrt(abs(x))
## Do not print as scientific notation!
# using Printf
# roundedstring(n::Number; digits::Int=6, kwargs...) = Printf.format(Printf.Format("%.$(digits)f"), round(n; digits, kwargs...))
function roundedstring(n::Number; digits::Int=6)
    io = IOBuffer()
    Base.show(io, MIME"text/plain"(), round(n; digits))
    return String(take!(io))
end
roundedstringInt(n::Number; kwargs...) = string(round(Int, n; kwargs...))


VectorDict(S::AbstractVector{<:AbstractString}) = Dict(1:length(S) .=> S)
# Ignore diagonal and below
UpperMatrixDict(F::AbstractMatrix{<:AbstractString}) = Dict((i,j) => F[i,j] for i in axes(F,1), j in axes(F,2) if i < j)
UpperMatrixDict(X::AbstractVector{<:AbstractString}) = Dict(Entry => X[i] for (i,Entry) in enumerate(ConstructMatrixIndices(X)))
# row-major order, i.e. strictly upper diagonal matrix line by line from left to right
ConstructMatrixIndices(S::AbstractVector) = (N = Int(0.5*(1+sqrt(8length(S)+1)));    [(i,j) for i in 1:N, j in 1:N if i < j])
NullDiagonalMatrixDict(F::AbstractMatrix{<:AbstractString}) = Dict((i,j) => F[i,j] for i in axes(F,1), j in axes(F,2) if i != j)
FullMatrixDict(F::AbstractMatrix{<:AbstractString}) = Dict((i,j) => F[i,j] for i in axes(F,1), j in axes(F,2))

"""
    MergeDictValues(D1::AbstractDict{A,B}, D2::AbstractDict{A,B}, MergeOp::Function=Base.:*)
Merge dicts and also merge values for keys that appear in both Dicts.
"""
function MergeDictValues(D1::AbstractDict{A,B}, D2::AbstractDict{A,B}, MergeOp::Function=Base.:*) where {A,B}
    D = Dict{A,B}()
    for k in unique!(vcat(collect(keys(D1)), collect(keys(D2))))
        Res = k ∈ keys(D1) ? (k ∈ keys(D2) ? MergeOp(D1[k], D2[k]) : D1[k]) : D2[k]
        push!(D, k => Res)
    end;    D
end

import InformationGeometry: ParameterGraph, ParameterGraphSymmetric, ParameterGraphAsymmetric
ParameterGraph(DM::AbstractDataModel, mle::AbstractVector{<:Number}=MLE(DM), F::AbstractMatrix{<:Number}=FisherMetric(DM, mle); 
                pnames::AbstractVector{<:AbstractString}=pnames(DM), kwargs...) = ParameterGraphSymmetric(F, pnames; pnames, kwargs...)


function ParameterGraphSymmetric(Fmatrix::AbstractMatrix{<:Number}, PNames::AbstractVector{<:StringOrSymb}="x".*string.(1:size(Fmatrix,2)); backend::Symbol=:TikZ, 
        nodetransform::Function=sqrt∘abs, transformedges::Bool=false, edgetransform::Function=(transformedges ? signsqrtabs : identity),
        F::AbstractMatrix{<:Number}=Symmetric(Fmatrix ./ maximum(abs, Fmatrix)), Latexify::Function=identity, 
        G::Graphs.SimpleGraph=Graphs.SimpleGraph(F - Diagonal(F)), pnames::AbstractVector{<:StringOrSymb}=PNames,
        NodeSize::AbstractVector{<:Number}=(nod=nodetransform.(Diagonal(F).diag);   nod ./ maximum(nod)),
        SignedEdgeWidth::AbstractVector{<:Number}=(Sedge=[edgetransform(F[i,j]) for i in axes(F,1), j in axes(F,2) if i < j];   Sedge ./ maximum(abs,Sedge)),
        diverging::Bool=true, graph_options::AbstractString="node distance=7em", options::AbstractString="", kwargs...)
    @assert backend === :TikZ
    # sqrt in nodetransform instead of cholesky(F)
    EdgeWidth = abs.(SignedEdgeWidth)

    TikzGraphs.plot(G; labels=repeat([""], length(pnames)), layout=Layouts.SimpleNecklace(),
        prepend_preamble=raw"""
        \usepackage{tikz,pgfplots}
        \usetikzlibrary{calc, pgfplots.colormaps}
        \colorlet{defaultcolor}{black}
        \colorlet{BackgroundColor}{white}
        \pgfplotsset{colormap/ReverseBalance/.style={/pgfplots/colormap={ReverseBalance}{rgb=(0.23605636, 0.03529748, 0.069437442) rgb=(0.24596222, 0.037625951, 0.074619136) rgb=(0.25588406, 0.039900466, 0.079722365) rgb=(0.26582514, 0.042061613, 0.084744722) rgb=(0.27578839, 0.044077295, 0.089683294) rgb=(0.28577617, 0.045955169, 0.094534697) rgb=(0.29579063, 0.047695428, 0.099295012) rgb=(0.30584405, 0.04927678, 0.10395692) rgb=(0.31592786, 0.050719341, 0.10851752) rgb=(0.32604244, 0.05202498, 0.11297139) rgb=(0.33620182, 0.053165773, 0.1173074) rgb=(0.34639461, 0.054167131, 0.12152211) rgb=(0.35662892, 0.055012362, 0.12560413) rgb=(0.36690097, 0.055710276, 0.12954563) rgb=(0.37721626, 0.056248587, 0.13333329) rgb=(0.38756618, 0.056647445, 0.13695962) rgb=(0.39795842, 0.056888991, 0.14040679) rgb=(0.40838748, 0.056986797, 0.14366262) rgb=(0.41884881, 0.056953513, 0.1467131) rgb=(0.42933959, 0.056798929, 0.1495413) rgb=(0.43985504, 0.056539675, 0.15212964) rgb=(0.45038823, 0.056200932, 0.15446036) rgb=(0.46092984, 0.055818175, 0.15651615) rgb=(0.47146853, 0.05543753, 0.15828036) rgb=(0.48199704, 0.055098742, 0.15972947) rgb=(0.49249206, 0.054894978, 0.16085946) rgb=(0.50294151, 0.054892687, 0.16165212) rgb=(0.51332147, 0.055199003, 0.16210827) rgb=(0.523612, 0.055910951, 0.16222653) rgb=(0.53379121, 0.057128581, 0.16201381) rgb=(0.54383514, 0.058949148, 0.16148955) rgb=(0.55372241, 0.061446269, 0.16067796) rgb=(0.56343372, 0.06466696, 0.15960971) rgb=(0.57295232, 0.068628702, 0.15832095) rgb=(0.58226407, 0.073321107, 0.15685285) rgb=(0.59135807, 0.07870938, 0.1552476) rgb=(0.60022601, 0.084742688, 0.15354719) rgb=(0.60886121, 0.091362711, 0.15179467) rgb=(0.61725809, 0.098509559, 0.15003428) rgb=(0.62541177, 0.10612632, 0.14830833) rgb=(0.63331719, 0.11416164, 0.14666355) rgb=(0.64096909, 0.1225709, 0.14514666) rgb=(0.64836184, 0.13131545, 0.14380938) rgb=(0.65548946, 0.14036226, 0.14270608) rgb=(0.66234629, 0.1496815, 0.1418967) rgb=(0.66892723, 0.15924601, 0.14144362) rgb=(0.67522904, 0.1690284, 0.14141262) rgb=(0.68125094, 0.17900057, 0.14186849) rgb=(0.68699563, 0.18913262, 0.14287203) rgb=(0.6924701, 0.19939235, 0.14447576) rgb=(0.69768564, 0.20974625, 0.14671934) rgb=(0.70265778, 0.22016032, 0.14962642) rgb=(0.70740461, 0.23060296, 0.15320278) rgb=(0.71194775, 0.24104317, 0.15743769) rgb=(0.71630775, 0.25145685, 0.16230504) rgb=(0.72050526, 0.26182377, 0.16776811) rgb=(0.72455978, 0.27212835, 0.17378304) rgb=(0.72848868, 0.28235996, 0.18030258) rgb=(0.73230751, 0.29251159, 0.18727887) rgb=(0.73602766, 0.30258171, 0.19466697) rgb=(0.73966264, 0.31256672, 0.20242263) rgb=(0.74322062, 0.32246895, 0.2105073) rgb=(0.74670837, 0.33229173, 0.21888681) rgb=(0.75013244, 0.3420382, 0.22753009) rgb=(0.75350142, 0.3517092, 0.23640702) rgb=(0.75681552, 0.36131299, 0.24549744) rgb=(0.76007961, 0.37085287, 0.25477962) rgb=(0.76329775, 0.38033247, 0.26423455) rgb=(0.76647331, 0.38975562, 0.27384573) rgb=(0.7696091, 0.39912628, 0.28359883) rgb=(0.77270738, 0.40844842, 0.29348145) rgb=(0.77577003, 0.41772599, 0.30348288) rgb=(0.7787986, 0.42696282, 0.31359382) rgb=(0.78179438, 0.43616264, 0.32380621) rgb=(0.78475844, 0.44532901, 0.334113) rgb=(0.78769221, 0.45446502, 0.34450752) rgb=(0.79060209, 0.46357018, 0.35497832) rgb=(0.79348534, 0.4726501, 0.36552429) rgb=(0.79634125, 0.48170863, 0.37614268) rgb=(0.79917761, 0.49074411, 0.38682195) rgb=(0.80199136, 0.49976163, 0.39756263) rgb=(0.804783, 0.50876385, 0.40836176) rgb=(0.80756008, 0.51774912, 0.41920905) rgb=(0.81031573, 0.52672425, 0.43011) rgb=(0.81305988, 0.53568615, 0.44105231) rgb=(0.8157858, 0.5446412, 0.45204172) rgb=(0.81850284, 0.55358664, 0.463067) rgb=(0.82120472, 0.5625283, 0.47413374) rgb=(0.82390077, 0.57146348, 0.48523112) rgb=(0.82658652, 0.58039681, 0.49636308) rgb=(0.82926584, 0.58932842, 0.50752486) rgb=(0.8319417, 0.59825898, 0.51871286) rgb=(0.8346115, 0.60719184, 0.52992929) rgb=(0.83728236, 0.61612552, 0.54116651) rgb=(0.83995267, 0.62506283, 0.55242594) rgb=(0.84262333, 0.63400527, 0.56370649) rgb=(0.84529929, 0.64295243, 0.57500309) rgb=(0.84798038, 0.6519063, 0.58631596) rgb=(0.85066718, 0.66086845, 0.59764454) rgb=(0.85336475, 0.66983845, 0.60898403) rgb=(0.85607377, 0.67881784, 0.62033401) rgb=(0.85879456, 0.68780825, 0.63169442) rgb=(0.86153122, 0.69680968, 0.64306165) rgb=(0.86428554, 0.70582315, 0.65443443) rgb=(0.86705966, 0.71484951, 0.6658112) rgb=(0.86985472, 0.72389001, 0.6771914) rgb=(0.87267498, 0.73294464, 0.68857164) rgb=(0.87552202, 0.74201448, 0.69995114) rgb=(0.87839898, 0.75110001, 0.71132772) rgb=(0.88130757, 0.76020224, 0.72270059) rgb=(0.88425152, 0.76932142, 0.73406721) rgb=(0.88723415, 0.77845801, 0.74542553) rgb=(0.89025854, 0.78761252, 0.7567738) rgb=(0.8933281, 0.79678541, 0.76811006) rgb=(0.8964464, 0.80597704, 0.77943233) rgb=(0.89961835, 0.81518734, 0.79073759) rgb=(0.90284824, 0.8244165, 0.8020235) rgb=(0.90614135, 0.83366435, 0.81328703) rgb=(0.90950339, 0.84293065, 0.82452495) rgb=(0.91294097, 0.85221483, 0.83573351) rgb=(0.91646227, 0.86151587, 0.84690792) rgb=(0.92007678, 0.87083231, 0.85804265) rgb=(0.92379637, 0.88016199, 0.86913066) rgb=(0.92763669, 0.88950153, 0.88016251) rgb=(0.93161955, 0.89884559, 0.89112473) rgb=(0.93577882, 0.90818496, 0.9019959) rgb=(0.94017715, 0.9175011, 0.9127353) rgb=(0.94502413, 0.9267274, 0.92320173) rgb=(0.94387686, 0.92709058, 0.92414784) rgb=(0.93376907, 0.91953891, 0.91796043) rgb=(0.92339067, 0.91214345, 0.91198727) rgb=(0.91286295, 0.90486468, 0.90612019) rgb=(0.90223219, 0.89768518, 0.90033034) rgb=(0.89151256, 0.89059766, 0.89461579) rgb=(0.8807226, 0.88359376, 0.88896898) rgb=(0.86987188, 0.87666811, 0.88338843) rgb=(0.85896284, 0.86981769, 0.87787684) rgb=(0.84800383, 0.86303779, 0.87243156) rgb=(0.83699675, 0.85632577, 0.86705416) rgb=(0.82594216, 0.84967946, 0.86174654) rgb=(0.81484311, 0.84309597, 0.85650845) rgb=(0.80369975, 0.8365733, 0.85134141) rgb=(0.79251162, 0.83010967, 0.8462471) rgb=(0.78127895, 0.82370305, 0.84122655) rgb=(0.7700007, 0.81735182, 0.83628157) rgb=(0.75867599, 0.81105425, 0.83141375) rgb=(0.74730444, 0.80480845, 0.82662434) rgb=(0.7358837, 0.79861307, 0.8219159) rgb=(0.72441124, 0.79246672, 0.81729113) rgb=(0.71288853, 0.78636686, 0.81275022) rgb=(0.70131075, 0.78031263, 0.80829755) rgb=(0.6896755, 0.77430243, 0.8039361) rgb=(0.67798504, 0.76833329, 0.799666) rgb=(0.66623153, 0.76240488, 0.79549418) rgb=(0.6544186, 0.75651373, 0.79142043) rgb=(0.64254033, 0.75065877, 0.78745106) rgb=(0.63059636, 0.74483734, 0.78358922) rgb=(0.61858647, 0.73904668, 0.77983837) rgb=(0.60650809, 0.73328445, 0.77620411) rgb=(0.59436024, 0.7275478, 0.77269163) rgb=(0.58214859, 0.72183221, 0.76930236) rgb=(0.56986354, 0.71613651, 0.76604883) rgb=(0.55751816, 0.71045432, 0.76292914) rgb=(0.54511511, 0.70478153, 0.7599493) rgb=(0.53265066, 0.6991152, 0.75712102) rgb=(0.52013952, 0.69344853, 0.75444409) rgb=(0.50759227, 0.68777566, 0.75192214) rgb=(0.49502055, 0.68209061, 0.7495589) rgb=(0.48243916, 0.67638699, 0.74735656) rgb=(0.46986588, 0.67065815, 0.74531538) rgb=(0.45732109, 0.66489739, 0.74343353) rgb=(0.44482701, 0.65909826, 0.74170693) rgb=(0.43240665, 0.65325485, 0.74012945) rgb=(0.42008256, 0.64736207, 0.73869308) rgb=(0.40787554, 0.64141586, 0.73738846) rgb=(0.39580281, 0.63541344, 0.73620602) rgb=(0.38387988, 0.62935306, 0.73513375) rgb=(0.37211638, 0.62323432, 0.73416123) rgb=(0.36051697, 0.6170579, 0.73327922) rgb=(0.3490818, 0.61082531, 0.73247968) rgb=(0.33780753, 0.60453865, 0.73175521) rgb=(0.32668681, 0.59820041, 0.7311006) rgb=(0.31570894, 0.59181322, 0.73051298) rgb=(0.30486166, 0.58537967, 0.72999025) rgb=(0.29413138, 0.57890214, 0.72953149) rgb=(0.28350369, 0.57238271, 0.72913673) rgb=(0.27296382, 0.56582312, 0.72880681) rgb=(0.26249697, 0.55922467, 0.72854317) rgb=(0.2520886, 0.55258823, 0.72834769) rgb=(0.24172459, 0.54591421, 0.72822258) rgb=(0.23139144, 0.53920256, 0.7281702) rgb=(0.22107637, 0.53245276, 0.72819301) rgb=(0.21076743, 0.52566384, 0.72829343) rgb=(0.20045367, 0.51883439, 0.72847377) rgb=(0.19012529, 0.51196251, 0.72873614) rgb=(0.17977386, 0.50504587, 0.72908242) rgb=(0.16939271, 0.49808168, 0.7295141) rgb=(0.15897744, 0.49106666, 0.73003226) rgb=(0.14852667, 0.48399707, 0.73063745) rgb=(0.13804321, 0.47686868, 0.73132951) rgb=(0.1275358, 0.46967672, 0.7321075) rgb=(0.11702165, 0.46241591, 0.73296937) rgb=(0.10653039, 0.45508042, 0.73391177) rgb=(0.096110239, 0.44766357, 0.73493125) rgb=(0.085837104, 0.44015834, 0.73602068) rgb=(0.075827891, 0.43255722, 0.73716979) rgb=(0.066260175, 0.42485215, 0.73836501) rgb=(0.057398001, 0.4170347, 0.73958775) rgb=(0.049624319, 0.40909532, 0.74081668) rgb=(0.043458439, 0.40102371, 0.7420243) rgb=(0.039483495, 0.39281375, 0.74315813) rgb=(0.038315765, 0.38445368, 0.74417463) rgb=(0.040236313, 0.37594185, 0.74498414) rgb=(0.045209385, 0.36727493, 0.74548891) rgb=(0.052832584, 0.35846008, 0.74554518) rgb=(0.062522326, 0.34951974, 0.7449563) rgb=(0.073676887, 0.34049675, 0.74346934) rgb=(0.085700238, 0.33146616, 0.74077181) rgb=(0.097958434, 0.3225431, 0.73652716) rgb=(0.10982269, 0.31386519, 0.73046944) rgb=(0.12070563, 0.30556233, 0.72251014) rgb=(0.13019375, 0.29771375, 0.71279281) rgb=(0.13815067, 0.29032903, 0.70161667) rgb=(0.14461903, 0.28337034, 0.68933032) rgb=(0.14975399, 0.27677729, 0.67624289) rgb=(0.15374227, 0.27048752, 0.66259429) rgb=(0.15673874, 0.26444442, 0.64858326) rgb=(0.15891657, 0.25860221, 0.63431839) rgb=(0.16037934, 0.2529213, 0.61991794) rgb=(0.16123528, 0.24737119, 0.60544468) rgb=(0.16156876, 0.24192717, 0.59094728) rgb=(0.16144553, 0.23656876, 0.57646619) rgb=(0.16092053, 0.23127922, 0.5620308) rgb=(0.16003963, 0.22604481, 0.54766269) rgb=(0.15884111, 0.22085406, 0.5333781) rgb=(0.15735349, 0.21569621, 0.51919772) rgb=(0.1556073, 0.2105639, 0.5051242) rgb=(0.15362665, 0.20545038, 0.49116235) rgb=(0.15143093, 0.20034937, 0.47731853) rgb=(0.14903482, 0.19525448, 0.46360362) rgb=(0.14645608, 0.19016193, 0.4500131) rgb=(0.14370728, 0.18506718, 0.43655022) rgb=(0.14079963, 0.17996609, 0.42321738) rgb=(0.13774403, 0.17485525, 0.41001322) rgb=(0.13454904, 0.16973078, 0.39694025) rgb=(0.13122438, 0.16458993, 0.3839939) rgb=(0.12777784, 0.1594293, 0.37117372) rgb=(0.12421597, 0.1542449, 0.35848249) rgb=(0.12054634, 0.14903305, 0.34591927) rgb=(0.11677874, 0.14379072, 0.33347631) rgb=(0.1129223, 0.13851314, 0.32115284) rgb=(0.1089874, 0.1331935, 0.30895384) rgb=(0.1049927, 0.12782437, 0.29687381) rgb=(0.10096885, 0.12239315, 0.28491036) rgb=(0.096971515, 0.11687021, 0.27309631) rgb=(0.093176302, 0.11117333, 0.26151239)},},}
        """ * "\n\n", # Not needed later
        graph_options,
        options=(diverging ? raw"/pgfplots/colormap/ReverseBalance, " : raw"/pgfplots/colormap/viridis, ") * raw"coloring/.style={/utils/exec={\pgfplotscolormapdefinemappedcolor{#1}}, draw=mapped color}, " * options,
        node_style="draw, circle, fill=defaultcolor!30!BackgroundColor, outer sep=0pt", 
        node_styles=VectorDict(raw"label={60:{" .* string.(Latexify.(pnames)) .* raw"}}, " .* "inner sep=" .* roundedstring.(7NodeSize) .* "pt,"),
        edge_styles=UpperMatrixDict("line width=" .* roundedstring.(6.5EdgeWidth) .* "pt" .* ", coloring=" .* roundedstringInt.(1000 .* (diverging ? 0.9 .* (0.5.*SignedEdgeWidth) .+ 0.5 : EdgeWidth))),
        kwargs...
    )
end


# SelfInteraction = false to remove diagonal from Matrix to disable selfarrows but use for node size
function ParameterGraphAsymmetric(Fmatrix::AbstractMatrix{<:Number}, PNames::AbstractVector{<:AbstractString}="x".*string.(1:size(Fmatrix,2)); backend::Symbol=:TikZ, 
        nodetransform::Function=sqrt∘abs, transformedges::Bool=false, edgetransform::Function=(transformedges ? signsqrtabs : identity),
        F::AbstractMatrix{<:Number}=Fmatrix ./ maximum(abs, Fmatrix), SelfInteraction::Bool=true, Latexify::Function=identity, 
        G::SimpleDiGraph=Graphs.SimpleDiGraph((SelfInteraction ? F : (F - Diagonal(F)))), pnames::AbstractVector{<:AbstractString}=PNames,
        NodeSize::AbstractVector{<:Number}=SelfInteraction ? fill(0.75, size(Fmatrix,1)) : (nod=nodetransform.(Diagonal(F).diag);   nod ./ maximum(nod)), 
        SignedEdgeWidth::AbstractArray{<:Number}=(Sedge=[edgetransform(F[i,j]) for i in axes(F,1), j in axes(F,2)];   Sedge ./ maximum(abs,Sedge)),
        diverging::Bool=true, graph_options::AbstractString="node distance=7em", options::AbstractString="", kwargs...)
    @assert backend === :TikZ
    # sqrt here instead of cholesky(F)
    # SignedEdgeWidth = [i==j ? 0 : edgetransform(F[i,j]) for i in axes(F,1), j in axes(F,2)]
    EdgeWidth = abs.(SignedEdgeWidth)
    # Make self interaction into loop, otherwise bend
    LoopMat = [i==j ? ", loop" : ", bend left" for i in axes(F,1), j in axes(F,2)]

    TikzGraphs.plot(G; labels=repeat([""], length(pnames)), layout=Layouts.SimpleNecklace(),
        prepend_preamble=raw"""
        \usepackage{tikz,pgfplots}
        \usetikzlibrary{calc, pgfplots.colormaps}
        \colorlet{defaultcolor}{black}
        \colorlet{BackgroundColor}{white}
        \tikzset{>=latex}
        \pgfplotsset{colormap/ReverseBalance/.style={/pgfplots/colormap={ReverseBalance}{rgb=(0.23605636, 0.03529748, 0.069437442) rgb=(0.24596222, 0.037625951, 0.074619136) rgb=(0.25588406, 0.039900466, 0.079722365) rgb=(0.26582514, 0.042061613, 0.084744722) rgb=(0.27578839, 0.044077295, 0.089683294) rgb=(0.28577617, 0.045955169, 0.094534697) rgb=(0.29579063, 0.047695428, 0.099295012) rgb=(0.30584405, 0.04927678, 0.10395692) rgb=(0.31592786, 0.050719341, 0.10851752) rgb=(0.32604244, 0.05202498, 0.11297139) rgb=(0.33620182, 0.053165773, 0.1173074) rgb=(0.34639461, 0.054167131, 0.12152211) rgb=(0.35662892, 0.055012362, 0.12560413) rgb=(0.36690097, 0.055710276, 0.12954563) rgb=(0.37721626, 0.056248587, 0.13333329) rgb=(0.38756618, 0.056647445, 0.13695962) rgb=(0.39795842, 0.056888991, 0.14040679) rgb=(0.40838748, 0.056986797, 0.14366262) rgb=(0.41884881, 0.056953513, 0.1467131) rgb=(0.42933959, 0.056798929, 0.1495413) rgb=(0.43985504, 0.056539675, 0.15212964) rgb=(0.45038823, 0.056200932, 0.15446036) rgb=(0.46092984, 0.055818175, 0.15651615) rgb=(0.47146853, 0.05543753, 0.15828036) rgb=(0.48199704, 0.055098742, 0.15972947) rgb=(0.49249206, 0.054894978, 0.16085946) rgb=(0.50294151, 0.054892687, 0.16165212) rgb=(0.51332147, 0.055199003, 0.16210827) rgb=(0.523612, 0.055910951, 0.16222653) rgb=(0.53379121, 0.057128581, 0.16201381) rgb=(0.54383514, 0.058949148, 0.16148955) rgb=(0.55372241, 0.061446269, 0.16067796) rgb=(0.56343372, 0.06466696, 0.15960971) rgb=(0.57295232, 0.068628702, 0.15832095) rgb=(0.58226407, 0.073321107, 0.15685285) rgb=(0.59135807, 0.07870938, 0.1552476) rgb=(0.60022601, 0.084742688, 0.15354719) rgb=(0.60886121, 0.091362711, 0.15179467) rgb=(0.61725809, 0.098509559, 0.15003428) rgb=(0.62541177, 0.10612632, 0.14830833) rgb=(0.63331719, 0.11416164, 0.14666355) rgb=(0.64096909, 0.1225709, 0.14514666) rgb=(0.64836184, 0.13131545, 0.14380938) rgb=(0.65548946, 0.14036226, 0.14270608) rgb=(0.66234629, 0.1496815, 0.1418967) rgb=(0.66892723, 0.15924601, 0.14144362) rgb=(0.67522904, 0.1690284, 0.14141262) rgb=(0.68125094, 0.17900057, 0.14186849) rgb=(0.68699563, 0.18913262, 0.14287203) rgb=(0.6924701, 0.19939235, 0.14447576) rgb=(0.69768564, 0.20974625, 0.14671934) rgb=(0.70265778, 0.22016032, 0.14962642) rgb=(0.70740461, 0.23060296, 0.15320278) rgb=(0.71194775, 0.24104317, 0.15743769) rgb=(0.71630775, 0.25145685, 0.16230504) rgb=(0.72050526, 0.26182377, 0.16776811) rgb=(0.72455978, 0.27212835, 0.17378304) rgb=(0.72848868, 0.28235996, 0.18030258) rgb=(0.73230751, 0.29251159, 0.18727887) rgb=(0.73602766, 0.30258171, 0.19466697) rgb=(0.73966264, 0.31256672, 0.20242263) rgb=(0.74322062, 0.32246895, 0.2105073) rgb=(0.74670837, 0.33229173, 0.21888681) rgb=(0.75013244, 0.3420382, 0.22753009) rgb=(0.75350142, 0.3517092, 0.23640702) rgb=(0.75681552, 0.36131299, 0.24549744) rgb=(0.76007961, 0.37085287, 0.25477962) rgb=(0.76329775, 0.38033247, 0.26423455) rgb=(0.76647331, 0.38975562, 0.27384573) rgb=(0.7696091, 0.39912628, 0.28359883) rgb=(0.77270738, 0.40844842, 0.29348145) rgb=(0.77577003, 0.41772599, 0.30348288) rgb=(0.7787986, 0.42696282, 0.31359382) rgb=(0.78179438, 0.43616264, 0.32380621) rgb=(0.78475844, 0.44532901, 0.334113) rgb=(0.78769221, 0.45446502, 0.34450752) rgb=(0.79060209, 0.46357018, 0.35497832) rgb=(0.79348534, 0.4726501, 0.36552429) rgb=(0.79634125, 0.48170863, 0.37614268) rgb=(0.79917761, 0.49074411, 0.38682195) rgb=(0.80199136, 0.49976163, 0.39756263) rgb=(0.804783, 0.50876385, 0.40836176) rgb=(0.80756008, 0.51774912, 0.41920905) rgb=(0.81031573, 0.52672425, 0.43011) rgb=(0.81305988, 0.53568615, 0.44105231) rgb=(0.8157858, 0.5446412, 0.45204172) rgb=(0.81850284, 0.55358664, 0.463067) rgb=(0.82120472, 0.5625283, 0.47413374) rgb=(0.82390077, 0.57146348, 0.48523112) rgb=(0.82658652, 0.58039681, 0.49636308) rgb=(0.82926584, 0.58932842, 0.50752486) rgb=(0.8319417, 0.59825898, 0.51871286) rgb=(0.8346115, 0.60719184, 0.52992929) rgb=(0.83728236, 0.61612552, 0.54116651) rgb=(0.83995267, 0.62506283, 0.55242594) rgb=(0.84262333, 0.63400527, 0.56370649) rgb=(0.84529929, 0.64295243, 0.57500309) rgb=(0.84798038, 0.6519063, 0.58631596) rgb=(0.85066718, 0.66086845, 0.59764454) rgb=(0.85336475, 0.66983845, 0.60898403) rgb=(0.85607377, 0.67881784, 0.62033401) rgb=(0.85879456, 0.68780825, 0.63169442) rgb=(0.86153122, 0.69680968, 0.64306165) rgb=(0.86428554, 0.70582315, 0.65443443) rgb=(0.86705966, 0.71484951, 0.6658112) rgb=(0.86985472, 0.72389001, 0.6771914) rgb=(0.87267498, 0.73294464, 0.68857164) rgb=(0.87552202, 0.74201448, 0.69995114) rgb=(0.87839898, 0.75110001, 0.71132772) rgb=(0.88130757, 0.76020224, 0.72270059) rgb=(0.88425152, 0.76932142, 0.73406721) rgb=(0.88723415, 0.77845801, 0.74542553) rgb=(0.89025854, 0.78761252, 0.7567738) rgb=(0.8933281, 0.79678541, 0.76811006) rgb=(0.8964464, 0.80597704, 0.77943233) rgb=(0.89961835, 0.81518734, 0.79073759) rgb=(0.90284824, 0.8244165, 0.8020235) rgb=(0.90614135, 0.83366435, 0.81328703) rgb=(0.90950339, 0.84293065, 0.82452495) rgb=(0.91294097, 0.85221483, 0.83573351) rgb=(0.91646227, 0.86151587, 0.84690792) rgb=(0.92007678, 0.87083231, 0.85804265) rgb=(0.92379637, 0.88016199, 0.86913066) rgb=(0.92763669, 0.88950153, 0.88016251) rgb=(0.93161955, 0.89884559, 0.89112473) rgb=(0.93577882, 0.90818496, 0.9019959) rgb=(0.94017715, 0.9175011, 0.9127353) rgb=(0.94502413, 0.9267274, 0.92320173) rgb=(0.94387686, 0.92709058, 0.92414784) rgb=(0.93376907, 0.91953891, 0.91796043) rgb=(0.92339067, 0.91214345, 0.91198727) rgb=(0.91286295, 0.90486468, 0.90612019) rgb=(0.90223219, 0.89768518, 0.90033034) rgb=(0.89151256, 0.89059766, 0.89461579) rgb=(0.8807226, 0.88359376, 0.88896898) rgb=(0.86987188, 0.87666811, 0.88338843) rgb=(0.85896284, 0.86981769, 0.87787684) rgb=(0.84800383, 0.86303779, 0.87243156) rgb=(0.83699675, 0.85632577, 0.86705416) rgb=(0.82594216, 0.84967946, 0.86174654) rgb=(0.81484311, 0.84309597, 0.85650845) rgb=(0.80369975, 0.8365733, 0.85134141) rgb=(0.79251162, 0.83010967, 0.8462471) rgb=(0.78127895, 0.82370305, 0.84122655) rgb=(0.7700007, 0.81735182, 0.83628157) rgb=(0.75867599, 0.81105425, 0.83141375) rgb=(0.74730444, 0.80480845, 0.82662434) rgb=(0.7358837, 0.79861307, 0.8219159) rgb=(0.72441124, 0.79246672, 0.81729113) rgb=(0.71288853, 0.78636686, 0.81275022) rgb=(0.70131075, 0.78031263, 0.80829755) rgb=(0.6896755, 0.77430243, 0.8039361) rgb=(0.67798504, 0.76833329, 0.799666) rgb=(0.66623153, 0.76240488, 0.79549418) rgb=(0.6544186, 0.75651373, 0.79142043) rgb=(0.64254033, 0.75065877, 0.78745106) rgb=(0.63059636, 0.74483734, 0.78358922) rgb=(0.61858647, 0.73904668, 0.77983837) rgb=(0.60650809, 0.73328445, 0.77620411) rgb=(0.59436024, 0.7275478, 0.77269163) rgb=(0.58214859, 0.72183221, 0.76930236) rgb=(0.56986354, 0.71613651, 0.76604883) rgb=(0.55751816, 0.71045432, 0.76292914) rgb=(0.54511511, 0.70478153, 0.7599493) rgb=(0.53265066, 0.6991152, 0.75712102) rgb=(0.52013952, 0.69344853, 0.75444409) rgb=(0.50759227, 0.68777566, 0.75192214) rgb=(0.49502055, 0.68209061, 0.7495589) rgb=(0.48243916, 0.67638699, 0.74735656) rgb=(0.46986588, 0.67065815, 0.74531538) rgb=(0.45732109, 0.66489739, 0.74343353) rgb=(0.44482701, 0.65909826, 0.74170693) rgb=(0.43240665, 0.65325485, 0.74012945) rgb=(0.42008256, 0.64736207, 0.73869308) rgb=(0.40787554, 0.64141586, 0.73738846) rgb=(0.39580281, 0.63541344, 0.73620602) rgb=(0.38387988, 0.62935306, 0.73513375) rgb=(0.37211638, 0.62323432, 0.73416123) rgb=(0.36051697, 0.6170579, 0.73327922) rgb=(0.3490818, 0.61082531, 0.73247968) rgb=(0.33780753, 0.60453865, 0.73175521) rgb=(0.32668681, 0.59820041, 0.7311006) rgb=(0.31570894, 0.59181322, 0.73051298) rgb=(0.30486166, 0.58537967, 0.72999025) rgb=(0.29413138, 0.57890214, 0.72953149) rgb=(0.28350369, 0.57238271, 0.72913673) rgb=(0.27296382, 0.56582312, 0.72880681) rgb=(0.26249697, 0.55922467, 0.72854317) rgb=(0.2520886, 0.55258823, 0.72834769) rgb=(0.24172459, 0.54591421, 0.72822258) rgb=(0.23139144, 0.53920256, 0.7281702) rgb=(0.22107637, 0.53245276, 0.72819301) rgb=(0.21076743, 0.52566384, 0.72829343) rgb=(0.20045367, 0.51883439, 0.72847377) rgb=(0.19012529, 0.51196251, 0.72873614) rgb=(0.17977386, 0.50504587, 0.72908242) rgb=(0.16939271, 0.49808168, 0.7295141) rgb=(0.15897744, 0.49106666, 0.73003226) rgb=(0.14852667, 0.48399707, 0.73063745) rgb=(0.13804321, 0.47686868, 0.73132951) rgb=(0.1275358, 0.46967672, 0.7321075) rgb=(0.11702165, 0.46241591, 0.73296937) rgb=(0.10653039, 0.45508042, 0.73391177) rgb=(0.096110239, 0.44766357, 0.73493125) rgb=(0.085837104, 0.44015834, 0.73602068) rgb=(0.075827891, 0.43255722, 0.73716979) rgb=(0.066260175, 0.42485215, 0.73836501) rgb=(0.057398001, 0.4170347, 0.73958775) rgb=(0.049624319, 0.40909532, 0.74081668) rgb=(0.043458439, 0.40102371, 0.7420243) rgb=(0.039483495, 0.39281375, 0.74315813) rgb=(0.038315765, 0.38445368, 0.74417463) rgb=(0.040236313, 0.37594185, 0.74498414) rgb=(0.045209385, 0.36727493, 0.74548891) rgb=(0.052832584, 0.35846008, 0.74554518) rgb=(0.062522326, 0.34951974, 0.7449563) rgb=(0.073676887, 0.34049675, 0.74346934) rgb=(0.085700238, 0.33146616, 0.74077181) rgb=(0.097958434, 0.3225431, 0.73652716) rgb=(0.10982269, 0.31386519, 0.73046944) rgb=(0.12070563, 0.30556233, 0.72251014) rgb=(0.13019375, 0.29771375, 0.71279281) rgb=(0.13815067, 0.29032903, 0.70161667) rgb=(0.14461903, 0.28337034, 0.68933032) rgb=(0.14975399, 0.27677729, 0.67624289) rgb=(0.15374227, 0.27048752, 0.66259429) rgb=(0.15673874, 0.26444442, 0.64858326) rgb=(0.15891657, 0.25860221, 0.63431839) rgb=(0.16037934, 0.2529213, 0.61991794) rgb=(0.16123528, 0.24737119, 0.60544468) rgb=(0.16156876, 0.24192717, 0.59094728) rgb=(0.16144553, 0.23656876, 0.57646619) rgb=(0.16092053, 0.23127922, 0.5620308) rgb=(0.16003963, 0.22604481, 0.54766269) rgb=(0.15884111, 0.22085406, 0.5333781) rgb=(0.15735349, 0.21569621, 0.51919772) rgb=(0.1556073, 0.2105639, 0.5051242) rgb=(0.15362665, 0.20545038, 0.49116235) rgb=(0.15143093, 0.20034937, 0.47731853) rgb=(0.14903482, 0.19525448, 0.46360362) rgb=(0.14645608, 0.19016193, 0.4500131) rgb=(0.14370728, 0.18506718, 0.43655022) rgb=(0.14079963, 0.17996609, 0.42321738) rgb=(0.13774403, 0.17485525, 0.41001322) rgb=(0.13454904, 0.16973078, 0.39694025) rgb=(0.13122438, 0.16458993, 0.3839939) rgb=(0.12777784, 0.1594293, 0.37117372) rgb=(0.12421597, 0.1542449, 0.35848249) rgb=(0.12054634, 0.14903305, 0.34591927) rgb=(0.11677874, 0.14379072, 0.33347631) rgb=(0.1129223, 0.13851314, 0.32115284) rgb=(0.1089874, 0.1331935, 0.30895384) rgb=(0.1049927, 0.12782437, 0.29687381) rgb=(0.10096885, 0.12239315, 0.28491036) rgb=(0.096971515, 0.11687021, 0.27309631) rgb=(0.093176302, 0.11117333, 0.26151239)},},}
        """ * "\n\n", # Not needed later
        graph_options,
        options=(diverging ? raw"/pgfplots/colormap/ReverseBalance, " : raw"/pgfplots/colormap/viridis, ") * raw"coloring/.style={/utils/exec={\pgfplotscolormapdefinemappedcolor{#1}}, draw=mapped color}, " * options,
        node_style="draw, circle, fill=defaultcolor!30!BackgroundColor, outer sep=0pt", 
        node_styles=VectorDict(raw"label={60:{" .* string.(Latexify.(pnames)) .* raw"}}, " .* "inner sep=" .* roundedstring.(7NodeSize) .* "pt,"),
        # edge_style="bend left",
        ## FullMatrixDict instead of NullDiagonalMatrixDict for loops
        edge_styles=FullMatrixDict("line width=" .* roundedstring.(6.5EdgeWidth) .* "pt" .* ", coloring=" .* roundedstringInt.(1000 .* (diverging ? 0.9 .* (0.5.*SignedEdgeWidth) .+ 0.5 : EdgeWidth)) .* LoopMat),
        kwargs...
    )
end



import InformationGeometry: IdentifiabilityReport, IdentifiabilityReportGraph
function IdentifiabilityReportGraph(args...; threshold::Real=1e-10, Subset::Bool=true, verbose::Bool=true, SelfInteraction::Bool=false, kwargs...)
    Mat, Names = IdentifiabilityReport(args...; threshold, Subset, verbose)
    ParameterGraphAsymmetric(Mat+Diagonal(ones(length(Names))), Names; SelfInteraction, kwargs...)
end


end # module